<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<title>
Matthias Vallentin - High-Level Network Traffic Profiling
</title>
<link href='/css/main.css' rel='stylesheet'>
<link href='/css/prism.css' rel='stylesheet'>
<script src='/js/all.js'></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src='https://www.googletagmanager.com/gtag/js?id=UA-1823891-1'></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-1823891-1');
</script>

</head>
<body>
<main>
<div class='grid-x grid-padding-x align-center'>
<div class='cell medium-10 large-8'>
<div class='content'>
<h1>
High-Level Network Traffic Profiling
</h1>
<div class='grid-x grid-padding-x align-justify margin-bottom-1'>
<div class='cell shrink'>
<span class='label radius'>
<i class='fa fa-calendar-o'></i>
2011-12-16
</span>
</div>
<div class='cell shrink'>
<span class='label radius secondary'>
bro
</span>
<span class='label radius secondary'>
traffic analysis
</span>
<span class='label radius secondary'>
cluster
</span>
<span class='label radius secondary'>
meta programming
</span>
</div>
</div>
<p class="float-right padding-left-1"><img src="bro-workload.png" alt="Profiling Bro's event workload" /></p>
<p>When it comes to understanding your network traffic in terms of volume or
packet rate, the obvious approach is to count packets or add up their size. In
this article, I describe a higher-level alternative to profiling network
traffic based on events generated by the <a href="http://www.bro-ids.org">Bro</a> network
security monitor. Most of these events represent activity higher up the network
stack, e.g., at the transport and application layer. The difference between
traditional and event profiling is visualized in the Figure on the right.
Conventional tools munge on packets at the network layer; some may also
reassemble transport-layer streams. Bro’s event engine additionally generates
protocol-specific events that reflect the applications communication, which
gives the user a much richer description of what’s going on in the network.</p>

<p>The size of an event is given by the size of all its arguments (plus a little
bit of meta information, e.g., creation timestamp). How do we get such meta
data though? To date, Bro has limited meta programming support, which makes it
difficult to obtain these details. Thus I added a new <em>meta event</em> to Bro,
which the core generates in addition to each regular event. Here is an example
that shows how to handle this event:</p>

<pre><code class="language-bro">event meta_event(name: string, timestamp: time, size: count)&#x000A;    {&#x000A;    print fmt("%s\t%f\%d", name, timestamp, size);&#x000A;    }&#x000A;</code></pre>

<p>You can find a more complete example that writes information about all events
to a separate file <code>meta.log</code> in my <a href="https://github.com/mavam/brospects/blob/master/bro/meta.bro">brospects</a> repository. To use
this meta programming functionality, you need to use the topic branch
<code>topic/matthias/meta-analysis</code>. A fresh install might look like this:</p>

<pre><code class="language-none">git clone --recursive git://git.bro-ids.org/bro.git&#x000A;git checkout topic/matthias/meta-analysis&#x000A;./configure --prefix=PREFIX &amp;&amp; make &amp;&amp; make install&#x000A;</code></pre>

<p>To give a real world example of what you can do with this functionality, let us
analyze a trace captured at UC Berkeley (UCB) on October 17, 2011, at 2:35pm
for 10 minutes. At UCB’s network border, a Bro cluster of 26 nodes monitors two
10 Gbps links. The full packet trace has a size of 219 GB and contains 284
million packets in 6.5 million connections. When looking at the trace sizes on
the 26 nodes, we observe a median size of 8.1 GB (<script type="math/tex">\sigma = 2.2</script>) in a range
from 6.3 to 15 GB.</p>

<p>Let us inspect one 7.7 GB trace of a single cluster node in more detail. The
two Figures below show the number of events per second, once over time and once
their empirical distribution.</p>

<p><img src="blade00-events.png" alt="Events per second" class="float-center" />
<img src="blade00-events-ecdf.png" alt="ECDF of the number of events per second" class="float-center" /></p>

<p>In the above Figure, we see median rates of 10,760 (<script type="math/tex">\sigma = 2394</script>), which
correspond to 13.4 MB/sec. The peak rates is 22,460, or 35 MB/sec. The next
figure shows the distribution of event types. Because most of our traffic at
UCB is HTTP, it is not unsurprising that the HTTP events account for the
largest share.</p>

<p><img src="blade00-type-dist-count.png" alt="Distribution of event types" class="float-center" /></p>

<p>In the future, we hope to add more meta programming and introspection
functionality to Bro. Not only does this help to tune the scripts, but it also
makes it possible to gain new insight into your network that goes beyond
packet-level activity.</p>


<div class='separator-center margin-bottom-2'></div>
<a class='button expanded hollow radius' href='#' id='show-comments' onclick='disqus();'>
Load Comments
</a>
<div id='disqus_thread'>
<script>
  var disqus_shortname = 'mavam';
  var disqus_config = function () {
    this.page.url = 'http://matthias.vallentin.net/blog/2011/12/16/high-level-network-traffic-profiling/';
    this.page.identifier = '';
  };
  var disqus_loaded = false;
  function disqus() {
    if (!disqus_loaded){
      disqus_loaded = true;
      var d = document, s = d.createElement('script');
      s.src = '//' + disqus_shortname +'.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      // Hide the button after loading comments.
      d.getElementById('show-comments').style.display = 'none';
      return false;
    }
  };
</script>
</div>


</div>
</div>
</div>
</main>
<footer>
<div class='grid-x grid-padding-x'>
<div class='cell shrink show-for-medium'>
<div class='copyright'>
<i class='fa fa-copyright'></i>
2007-2018 Matthias Vallentin
</div>

</div>
<div class='cell auto'>
<ul class='menu vertical medium-horizontal'>
<li>
<a href='/#home'>
Home
</a>
</li>
<li>
<a href='/#bio'>
Bio
</a>
</li>
<li>
<a href='/#research'>
Research
</a>
</li>
<li>
<a href='/#presentations'>
Presentations
</a>
</li>
<li>
<a href='/#coursework'>
Course Work
</a>
</li>
<li>
<a href='/#projects'>
Projects
</a>
</li>
<li>
<a href='/#teaching'>
Teaching
</a>
</li>
<li>
<a href='/#blog'>
Blog
</a>
</li>
</ul>
</div>
<div class='cell shrink show-for-medium'>
<ul class='menu social'>
<li>
<a href='mailto:matthias@berkeley.edu'>
<i class='fa fa-envelope'></i>
</a>
</li>
<li>
<a href='https://www.linkedin.com/in/matthias-vallentin/'>
<i class='fa fa-linkedin'></i>
</a>
</li>
<li>
<a href='https://github.com/mavam'>
<i class='fa fa-github'></i>
</a>
</li>
</ul>

</div>
</div>
<div class='hide-for-medium'>
<ul class='menu social'>
<li>
<a href='mailto:matthias@berkeley.edu'>
<i class='fa fa-envelope'></i>
</a>
</li>
<li>
<a href='https://www.linkedin.com/in/matthias-vallentin/'>
<i class='fa fa-linkedin'></i>
</a>
</li>
<li>
<a href='https://github.com/mavam'>
<i class='fa fa-github'></i>
</a>
</li>
</ul>

<div class='copyright'>
<i class='fa fa-copyright'></i>
2007-2018 Matthias Vallentin
</div>

</div>

</footer>
<!-- Enable Foundation -->
<script>
  $(document).foundation();
</script>

</body>
</html>
